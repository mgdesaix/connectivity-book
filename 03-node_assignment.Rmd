# Node assignment {#assignment}

In `mignette`, node assignment data is one of the two main inputs into the migratory network model. Regardless of the methods used to collect these data, as input into the `mignette` migratory network model it needs to be in a specific format:

```{r, echo = F}
knitr::kable(mignette::amre_assign)
```

The first column specifies the *inferred* nodes in assignment. In the case of the genetic assignment data shown above, the breeding nodes are inferred from population assignment methods with individuals sampled from the nonbreeding range. The other column names refer to the nonbreeding node names, and the values are the number of individuals from a given nonbreeding node assigned to the respective breeding node specified by the row.

For the American Redstart example, we can get the assignment data in the format shown above based on population assignment data provided in `mignette` as well as the ecoregion information from the previous section.

The `amre_nonbreeding_range` data, from which we extracted the latitude and longitude coordinates of sampling locations to identify ecoregions in the previous section, also provides the breeding node assignment data from DeSaix et al. (2023). Creating the `nonbreeding_coords_nearest` object retained the same row order of data as in the original `amre_nonbreeding_range`, thus we can combine these data in the following way. **Note:** We are manually combining these data without a *join* by sample name or another identifier so it is always good to triple check that indeed the data are in the correct order when not using a join.


```{r, message = F, warning = F}
amre_assign_manual <- tibble("Breeding" = amre_nonbreeding_data$Breeding_assignment,
                             "Nonbreeding" = nonbreeding_coords_nearest$Region) %>%
  filter(Nonbreeding %in% ecoregions_keep) %>% # remove those nonbreeding nodes with <4 samples
  group_by(Breeding, Nonbreeding) %>%
  summarize(N = n(),
            .groups = "drop") %>%
  pivot_wider(names_from = Nonbreeding, values_from = N) %>%
  rename("AONU" = "Amazon/Orinoco-Northern Uplands",
         "ALM" = "Atlantic Lowland Mexico",
         "CAR" = "Caribbean",
         "HCA" = "Highland Central America",
         "LCA" = "Lowland Central America") %>%
  mutate(across(where(is.numeric), ~ifelse(is.na(.), 0, .))) # replace NAs with 0s
```

```r
amre_assign_manual
```

```{r, echo = F}
knitr::kable(amre_assign_manual)
```

We can see that we have effectively mapped the breeding population assignment meta data to the correct ecoregion based on our individual's sampling location. Great!

Now on to getting the [relative abundance](#abundance).
